<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documentation - Shelly</title>
    <link rel="icon" type="image/png" href="../assets/icons/favicon-32x32.png">
    <link rel="shortcut icon" href="../favicon.ico" type="image/x-icon">
    <link href="../assets/css/output.css" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/showdown@2.1.0/dist/showdown.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .hero-gradient { background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%); }
        
        /* GitHub-flavored Markdown Styles (dark mode) - matching GitHub's exact spacing */
        .prose {
            color: #e6edf3;
            font-size: 16px;
            line-height: 1.5;
            word-wrap: break-word;
        }
        .prose > *:first-child { margin-top: 0 !important; }
        .prose > *:last-child { margin-bottom: 0 !important; }
        
        /* Headings - GitHub uses 24px margin-top, 16px margin-bottom, with border for h1/h2 */
        .prose h1, .prose h2, .prose h3, .prose h4, .prose h5, .prose h6 {
            margin-top: 24px;
            margin-bottom: 16px;
            font-weight: 600;
            line-height: 1.25;
            color: #ffffff;
        }
        .prose h1 { font-size: 2em; padding-bottom: 0.3em; border-bottom: 1px solid #30363d; }
        .prose h2 { font-size: 1.5em; padding-bottom: 0.3em; border-bottom: 1px solid #30363d; }
        .prose h3 { font-size: 1.25em; }
        .prose h4 { font-size: 1em; }
        .prose h5 { font-size: 0.875em; }
        .prose h6 { font-size: 0.85em; color: #8b949e; }
        
        /* Paragraphs - GitHub uses 16px (1em) margin-bottom */
        .prose p {
            margin-top: 0;
            margin-bottom: 16px;
        }
        
        /* Inline code */
        .prose code {
            background-color: rgba(110, 118, 129, 0.4);
            padding: 0.2em 0.4em;
            border-radius: 6px;
            font-size: 85%;
            font-family: ui-monospace, SFMono-Regular, SF Mono, Menlo, Consolas, Liberation Mono, monospace;
        }
        
        /* Code blocks */
        .prose pre {
            background-color: #161b22;
            padding: 16px;
            border-radius: 6px;
            margin-top: 0;
            margin-bottom: 16px;
            overflow: auto;
            font-size: 85%;
            line-height: 1.45;
            border: 1px solid #30363d;
        }
        .prose pre code {
            background-color: transparent;
            padding: 0;
            border-radius: 0;
            font-size: 100%;
            line-height: inherit;
            word-wrap: normal;
            white-space: pre;
        }
        
        /* Images */
        .prose img {
            max-width: 100%;
            box-sizing: border-box;
            background-color: transparent;
        }
        
        /* Lists - GitHub uses 2em padding-left, 16px margin-bottom */
        .prose ul, .prose ol {
            margin-top: 0;
            margin-bottom: 16px;
            padding-left: 2em;
        }
        .prose ul { list-style-type: disc; }
        .prose ol { list-style-type: decimal; }
        .prose li {
            margin-top: 0.25em;
        }
        .prose li > p { margin-top: 16px; }
        .prose li + li { margin-top: 0.25em; }
        .prose ul ul, .prose ul ol, .prose ol ul, .prose ol ol {
            margin-top: 0;
            margin-bottom: 0;
        }
        
        /* Blockquotes */
        .prose blockquote {
            margin: 0 0 16px 0;
            padding: 0 1em;
            color: #8b949e;
            border-left: 0.25em solid #30363d;
        }
        .prose blockquote > :first-child { margin-top: 0; }
        .prose blockquote > :last-child { margin-bottom: 0; }
        
        /* Horizontal rules */
        .prose hr {
            height: 0.25em;
            padding: 0;
            margin: 24px 0;
            background-color: #30363d;
            border: 0;
        }
        
        /* Links */
        .prose a {
            color: #58a6ff;
            text-decoration: none;
        }
        .prose a:hover { text-decoration: underline; }
        
        /* Tables */
        .prose table {
            display: block;
            width: 100%;
            width: max-content;
            max-width: 100%;
            overflow: auto;
            margin-top: 0;
            margin-bottom: 16px;
            border-spacing: 0;
            border-collapse: collapse;
        }
        .prose th, .prose td {
            padding: 6px 13px;
            border: 1px solid #30363d;
        }
        .prose th {
            font-weight: 600;
            color: #ffffff;
        }
        .prose tr { background-color: #0d1117; border-top: 1px solid #21262d; }
        .prose tr:nth-child(2n) { background-color: #161b22; }
        
        /* Text formatting */
        .prose strong { font-weight: 600; color: #ffffff; }
        .prose em { font-style: italic; }
        .prose del { text-decoration: line-through; }
        
        /* Task lists */
        .prose input[type="checkbox"] {
            margin-right: 0.5em;
            vertical-align: middle;
        }
    </style>
</head>
<body class="bg-[#121212] text-white">
    <nav class="sticky top-0 z-50 bg-[#121212]/80 backdrop-blur-md border-b border-white/10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <a href="../index.html" class="flex items-center gap-2 group">
                    <img src="../assets/images/shelly_icon.png" alt="Shelly Icon" class="w-8 h-8 transition-transform group-hover:scale-110">
                    <span class="text-xl font-bold tracking-tight">SHELLY</span>
                </a>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-8">
                        <a href="../index.html" class="text-gray-300 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Home</a>
                        <a href="../downloads.html" class="text-gray-300 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Downloads</a>
                        <a href="../screenshots.html" class="text-gray-300 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Screenshots</a>
                        <a href="index.html" class="text-white px-3 py-2 rounded-md text-sm font-medium">Documentation</a>
                        <a href="../about.html" class="text-gray-300 hover:text-white px-3 py-2 rounded-md text-sm font-medium">About</a>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <a href="https://github.com/ZoeyErinBauer/Shelly-ALPM" target="_blank" class="text-gray-300 hover:text-white">
                        <i data-lucide="github" class="w-5 h-5"></i>
                    </a>
                    <a href="https://www.buymeacoffee.com/" target="_blank" class="bg-yellow-500 hover:bg-yellow-600 text-black px-4 py-2 rounded-full text-xs font-bold transition-colors">
                        Buy me a coffee
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <header class="hero-gradient py-24 px-4 border-b border-white/10">
        <div class="max-w-7xl mx-auto text-center">
            <h1 class="text-5xl md:text-7xl font-extrabold mb-6 tracking-tight">Documentation</h1>
            <p class="text-xl text-gray-400 max-w-2xl mx-auto">
                Everything you need to know about installing and using Shelly.
            </p>
        </div>
    </header>

    <main class="py-12 px-4">
        <div class="max-w-7xl mx-auto flex flex-col md:flex-row gap-8">
            <!-- Sidebar -->
            <aside class="w-full md:w-64 flex-shrink-0">
                <nav id="wiki-nav" class="space-y-1">
                    <h2 class="text-sm font-semibold text-gray-500 uppercase tracking-wider mb-4 px-3">Wiki Pages</h2>
                    <div id="wiki-list" class="space-y-1">
                        <p class="px-3 text-gray-500 text-sm">Loading pages...</p>
                    </div>
                </nav>
            </aside>

            <!-- Content -->
            <div class="flex-grow">
                <div id="content" class="prose prose-invert max-w-none">
                    <p class="text-center text-gray-500">Select a page from the sidebar.</p>
                </div>
            </div>
        </div>
    </main>

    <footer class="bg-black py-12 border-t border-white/10 mt-auto">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p class="text-gray-500 text-sm mb-4">Shelly is an open-source project licensed under GPL-2.0.</p>
            <div class="flex justify-center gap-6">
                <a href="https://github.com/ZoeyErinBauer/Shelly-ALPM" class="text-gray-400 hover:text-white transition-colors">GitHub</a>
                <a href="https://www.buymeacoffee.com/" class="text-gray-400 hover:text-white transition-colors">Donate</a>
            </div>
        </div>
    </footer>

    <script>
        lucide.createIcons();

        const repo = 'ZoeyErinBauer/Shelly-ALPM';
        const branch = 'master';
        const wikiPath = 'wiki';
        const contentDiv = document.getElementById('content');
        const wikiListDiv = document.getElementById('wiki-list');

        // Configure showdown with GFM
        const converter = new showdown.Converter({
            ghCompatibleHeaderId: true,
            tables: true,
            strikethrough: true,
            tasklists: true,
            ghCodeBlocks: true,
            simplifiedAutoLink: true,
            literalMidWordUnderscores: true,
            simpleLineBreaks: false
        });

        async function loadWikiPage(fileName) {
            contentDiv.innerHTML = '<p class="text-center text-gray-500">Loading page...</p>';
            try {
                const response = await fetch(`https://raw.githubusercontent.com/${repo}/${branch}/${wikiPath}/${fileName}`);
                if (!response.ok) throw new Error('Failed to fetch page');
                const text = await response.text();

                // Adjust image paths if they are relative
                // Wiki images in master/wiki/ often refer to files in the same dir or a subfolder
                const adjustedText = text.replace(/!\[(.*?)\]\((.*?)\)/g, (match, alt, path) => {
                    if (!path.startsWith('http')) {
                        return `![${alt}](https://raw.githubusercontent.com/${repo}/${branch}/${wikiPath}/${path})`;
                    }
                    return match;
                });

                const htmlContent = converter.makeHtml(adjustedText);
                contentDiv.innerHTML = htmlContent;
                
                // Apply syntax highlighting to code blocks
                contentDiv.querySelectorAll('pre code').forEach((block) => {
                    hljs.highlightElement(block);
                });
                
                // Update active state in sidebar
                document.querySelectorAll('.wiki-link').forEach(link => {
                    link.classList.remove('bg-white/10', 'text-white');
                    link.classList.add('text-gray-400');
                    if (link.dataset.file === fileName) {
                        link.classList.add('bg-white/10', 'text-white');
                        link.classList.remove('text-gray-400');
                    }
                });
            } catch (err) {
                contentDiv.innerHTML = '<p class="text-red-500">Error loading page.</p>';
                console.error(err);
            }
        }

        async function fetchWikiList() {
            try {
                const response = await fetch(`https://api.github.com/repos/${repo}/contents/${wikiPath}?ref=${branch}`);
                if (!response.ok) throw new Error('Failed to fetch wiki list');
                const files = await response.json();
                
                const mdFiles = files.filter(file => file.name.endsWith('.md'));
                
                if (mdFiles.length === 0) {
                    wikiListDiv.innerHTML = '<p class="px-3 text-gray-500 text-sm">No wiki pages found.</p>';
                    return;
                }

                wikiListDiv.innerHTML = '';
                mdFiles.forEach(file => {
                    const name = file.name.replace('.md', '').replace(/-/g, ' ');
                    const button = document.createElement('button');
                    button.className = 'wiki-link w-full text-left px-3 py-2 rounded-md text-sm font-medium text-gray-400 hover:text-white hover:bg-white/5 transition-colors capitalize';
                    button.textContent = name;
                    button.dataset.file = file.name;
                    button.onclick = () => loadWikiPage(file.name);
                    wikiListDiv.appendChild(button);
                });

                // Load Home.md by default if it exists, otherwise the first one
                const homePage = mdFiles.find(f => f.name.toLowerCase() === 'home.md') || mdFiles[0];
                if (homePage) {
                    loadWikiPage(homePage.name);
                }

            } catch (err) {
                wikiListDiv.innerHTML = '<p class="px-3 text-red-500 text-sm">Error loading wiki list.</p>';
                console.error(err);
            }
        }

        fetchWikiList();
    </script>
</body>
</html>
