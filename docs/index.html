<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documentation - Shelly</title>
    <link rel="icon" type="image/png" href="../assets/icons/favicon-32x32.png">
    <link rel="shortcut icon" href="../favicon.ico" type="image/x-icon">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .hero-gradient { background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%); }
        
        /* Documentation Styles */
        .prose { @apply text-gray-400 leading-relaxed; }
        .prose h1 { @apply text-4xl font-bold mb-8 mt-12 pb-2 border-b border-white/10 text-white; }
        .prose h2 { @apply text-2xl font-semibold mb-6 mt-12 pb-1 border-b border-white/5 text-white; }
        .prose h3 { @apply text-xl font-medium mb-4 mt-10 text-white; }
        .prose h4 { @apply text-lg font-medium mb-4 mt-8 text-white; }
        .prose p { @apply mb-6; }
        .prose code { @apply bg-white/10 px-1.5 py-0.5 rounded text-blue-300 font-mono text-sm; }
        .prose pre { @apply bg-[#0d1117] p-4 rounded-lg mb-8 overflow-x-auto border border-white/10; }
        .prose pre code { @apply bg-transparent p-0 text-sm text-gray-300; border: none !important; }
        .prose img { @apply rounded-xl border border-white/10 my-10 shadow-2xl mx-auto block; }
        .prose ul { @apply list-disc mb-8 space-y-3; }
        .prose ol { @apply list-decimal mb-8 space-y-3; }
        .prose li > ul, .prose li > ol { @apply mt-3 mb-0; }
        .prose blockquote { @apply border-l-4 border-gray-700 pl-6 italic my-8 text-gray-500; }
        .prose hr { @apply border-white/10 my-12; }
        .prose a { @apply text-blue-400 hover:underline; }
        .prose table { @apply w-full mb-8 border-collapse; }
        .prose th { @apply text-left border-b border-white/10 pb-2 font-semibold text-white; }
        .prose td { @apply py-2 border-b border-white/5; }
        /* Fix for list-item marker spacing */
        .prose ul, .prose ol { @apply list-outside pl-6; }
    </style>
</head>
<body class="bg-[#121212] text-white">
    <nav class="sticky top-0 z-50 bg-[#121212]/80 backdrop-blur-md border-b border-white/10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <a href="../index.html" class="flex items-center gap-2 group">
                    <img src="../assets/images/shelly_icon.png" alt="Shelly Icon" class="w-8 h-8 transition-transform group-hover:scale-110">
                    <span class="text-xl font-bold tracking-tight">SHELLY</span>
                </a>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-8">
                        <a href="../index.html" class="text-gray-300 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Home</a>
                        <a href="../downloads.html" class="text-gray-300 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Downloads</a>
                        <a href="../screenshots.html" class="text-gray-300 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Screenshots</a>
                        <a href="index.html" class="text-white px-3 py-2 rounded-md text-sm font-medium">Documentation</a>
                        <a href="../about.html" class="text-gray-300 hover:text-white px-3 py-2 rounded-md text-sm font-medium">About</a>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <a href="https://github.com/ZoeyErinBauer/Shelly-ALPM" target="_blank" class="text-gray-300 hover:text-white">
                        <i data-lucide="github" class="w-5 h-5"></i>
                    </a>
                    <a href="https://www.buymeacoffee.com/" target="_blank" class="bg-yellow-500 hover:bg-yellow-600 text-black px-4 py-2 rounded-full text-xs font-bold transition-colors">
                        Buy me a coffee
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <header class="hero-gradient py-24 px-4 border-b border-white/10">
        <div class="max-w-7xl mx-auto text-center">
            <h1 class="text-5xl md:text-7xl font-extrabold mb-6 tracking-tight">Documentation</h1>
            <p class="text-xl text-gray-400 max-w-2xl mx-auto">
                Everything you need to know about installing and using Shelly.
            </p>
        </div>
    </header>

    <main class="py-12 px-4">
        <div class="max-w-7xl mx-auto flex flex-col md:flex-row gap-8">
            <!-- Sidebar -->
            <aside class="w-full md:w-64 flex-shrink-0">
                <nav id="wiki-nav" class="space-y-1">
                    <h2 class="text-sm font-semibold text-gray-500 uppercase tracking-wider mb-4 px-3">Wiki Pages</h2>
                    <div id="wiki-list" class="space-y-1">
                        <p class="px-3 text-gray-500 text-sm">Loading pages...</p>
                    </div>
                </nav>
            </aside>

            <!-- Content -->
            <div class="flex-grow">
                <div id="content" class="prose max-w-none">
                    <p class="text-center text-gray-500">Select a page from the sidebar.</p>
                </div>
            </div>
        </div>
    </main>

    <footer class="bg-black py-12 border-t border-white/10 mt-auto">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p class="text-gray-500 text-sm mb-4">Shelly is an open-source project licensed under GPL-2.0.</p>
            <div class="flex justify-center gap-6">
                <a href="https://github.com/ZoeyErinBauer/Shelly-ALPM" class="text-gray-400 hover:text-white transition-colors">GitHub</a>
                <a href="https://www.buymeacoffee.com/" class="text-gray-400 hover:text-white transition-colors">Donate</a>
            </div>
        </div>
    </footer>

    <script>
        lucide.createIcons();

        const repo = 'ZoeyErinBauer/Shelly-ALPM';
        const branch = 'master';
        const wikiPath = 'wiki';
        const contentDiv = document.getElementById('content');
        const wikiListDiv = document.getElementById('wiki-list');

        if (typeof marked.setOptions === 'function') {
            marked.setOptions({
                breaks: true,
                gfm: true,
                highlight: function(code, lang) {
                    if (typeof hljs !== 'undefined') {
                        const language = hljs.getLanguage(lang) ? lang : 'plaintext';
                        return hljs.highlight(code, { language }).value;
                    }
                    return code;
                }
            });
        }

        async function loadWikiPage(fileName) {
            contentDiv.innerHTML = '<p class="text-center text-gray-500">Loading page...</p>';
            try {
                const response = await fetch(`https://raw.githubusercontent.com/${repo}/${branch}/${wikiPath}/${fileName}`);
                if (!response.ok) throw new Error('Failed to fetch page');
                const text = await response.text();

                // Adjust image paths if they are relative
                // Wiki images in master/wiki/ often refer to files in the same dir or a subfolder
                const adjustedText = text.replace(/!\[(.*?)\]\((.*?)\)/g, (match, alt, path) => {
                    if (!path.startsWith('http')) {
                        return `![${alt}](https://raw.githubusercontent.com/${repo}/${branch}/${wikiPath}/${path})`;
                    }
                    return match;
                });

                const htmlContent = marked.parse(adjustedText);
                contentDiv.innerHTML = htmlContent;
                
                // Update active state in sidebar
                document.querySelectorAll('.wiki-link').forEach(link => {
                    link.classList.remove('bg-white/10', 'text-white');
                    link.classList.add('text-gray-400');
                    if (link.dataset.file === fileName) {
                        link.classList.add('bg-white/10', 'text-white');
                        link.classList.remove('text-gray-400');
                    }
                });
            } catch (err) {
                contentDiv.innerHTML = '<p class="text-red-500">Error loading page.</p>';
                console.error(err);
            }
        }

        async function fetchWikiList() {
            try {
                const response = await fetch(`https://api.github.com/repos/${repo}/contents/${wikiPath}?ref=${branch}`);
                if (!response.ok) throw new Error('Failed to fetch wiki list');
                const files = await response.json();
                
                const mdFiles = files.filter(file => file.name.endsWith('.md'));
                
                if (mdFiles.length === 0) {
                    wikiListDiv.innerHTML = '<p class="px-3 text-gray-500 text-sm">No wiki pages found.</p>';
                    return;
                }

                wikiListDiv.innerHTML = '';
                mdFiles.forEach(file => {
                    const name = file.name.replace('.md', '').replace(/-/g, ' ');
                    const button = document.createElement('button');
                    button.className = 'wiki-link w-full text-left px-3 py-2 rounded-md text-sm font-medium text-gray-400 hover:text-white hover:bg-white/5 transition-colors capitalize';
                    button.textContent = name;
                    button.dataset.file = file.name;
                    button.onclick = () => loadWikiPage(file.name);
                    wikiListDiv.appendChild(button);
                });

                // Load Home.md by default if it exists, otherwise the first one
                const homePage = mdFiles.find(f => f.name.toLowerCase() === 'home.md') || mdFiles[0];
                if (homePage) {
                    loadWikiPage(homePage.name);
                }

            } catch (err) {
                wikiListDiv.innerHTML = '<p class="px-3 text-red-500 text-sm">Error loading wiki list.</p>';
                console.error(err);
            }
        }

        fetchWikiList();
    </script>
</body>
</html>
